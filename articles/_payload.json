[{"data":1,"prerenderedAt":795},["Reactive",2],{"articles":3},[4],{"_path":5,"_dir":6,"_draft":7,"_partial":7,"_locale":8,"title":9,"description":10,"author":11,"date":15,"layout":16,"body":17,"_type":789,"_id":790,"_source":791,"_file":792,"_extension":793,"sitemap":794},"/articles/setup-proxies-in-nuxt-for-laravel-sanctum","articles",false,"","Setup proxies in Nuxt for Laravel Sanctum","Create proxies for Laravel Sanctum in Nuxt to avoid CORS issues.",{"name":12,"avatarUrl":13,"link":14},"Marko Banušić","https://0.gravatar.com/avatar/56d26a93583d2b9e3269f35e1370b6619e83e84e446c09b7fd32b69507586697?size=512","https://twitter.com/mbanusic","2024-01-08T00:00:00.000Z","article",{"type":18,"children":19,"toc":781},"root",[20,28,43,48,70,90,97,116,135,148,161,271,307,313,318,331,342,352,364,370,415,579,584,604,638,752,758,775],{"type":21,"tag":22,"props":23,"children":25},"element","h1",{"id":24},"setup-proxies-in-nuxt-for-laravel-sanctum",[26],{"type":27,"value":9},"text",{"type":21,"tag":29,"props":30,"children":31},"p",{},[32,41],{"type":21,"tag":33,"props":34,"children":38},"a",{"href":35,"rel":36},"https://laravel.com/docs/10.x/sanctum",[37],"nofollow",[39],{"type":27,"value":40},"Laravel Sanctum",{"type":27,"value":42}," is a great package for authenticating users in a Laravel application. It's easy to setup and use, but it has one big issue. It doesn't work well with CORS.",{"type":21,"tag":29,"props":44,"children":45},{},[46],{"type":27,"value":47},"CORS stands for Cross-Origin Resource Sharing and it's a mechanism that allows a server to indicate any other origins (domain, scheme, or port) than its own from which a browser should permit loading of resources. It is a great tool for security, but it can be a pain to work with.",{"type":21,"tag":29,"props":49,"children":50},{},[51,53,60,62,68],{"type":27,"value":52},"This means that if you have a Laravel application running on ",{"type":21,"tag":54,"props":55,"children":57},"code",{"className":56},[],[58],{"type":27,"value":59},"https://example.com",{"type":27,"value":61}," and you want to make an API request to ",{"type":21,"tag":54,"props":63,"children":65},{"className":64},[],[66],{"type":27,"value":67},"https://api.example.com",{"type":27,"value":69}," you will get a CORS error.",{"type":21,"tag":29,"props":71,"children":72},{},[73,75,81,83,88],{"type":27,"value":74},"This is a big issue if you want to use Laravel Sanctum to authenticate users in a Nuxt application. Nuxt runs on ",{"type":21,"tag":54,"props":76,"children":78},{"className":77},[],[79],{"type":27,"value":80},"http://localhost:3000",{"type":27,"value":82}," in development and on ",{"type":21,"tag":54,"props":84,"children":86},{"className":85},[],[87],{"type":27,"value":59},{"type":27,"value":89}," in production. This means that you will get a CORS error when you try to authenticate a user in development.",{"type":21,"tag":91,"props":92,"children":94},"h2",{"id":93},"setup-proxies",[95],{"type":27,"value":96},"Setup proxies",{"type":21,"tag":29,"props":98,"children":99},{},[100,102,107,109,114],{"type":27,"value":101},"The solution to this problem is to setup proxies in Nuxt. Proxies allow you to proxy requests to a different URL. This means that you can proxy requests to ",{"type":21,"tag":54,"props":103,"children":105},{"className":104},[],[106],{"type":27,"value":67},{"type":27,"value":108}," to ",{"type":21,"tag":54,"props":110,"children":112},{"className":111},[],[113],{"type":27,"value":80},{"type":27,"value":115}," in development.",{"type":21,"tag":29,"props":117,"children":118},{},[119,121,126,128,133],{"type":27,"value":120},"This way you can make requests to ",{"type":21,"tag":54,"props":122,"children":124},{"className":123},[],[125],{"type":27,"value":80},{"type":27,"value":127}," in development and ",{"type":21,"tag":54,"props":129,"children":131},{"className":130},[],[132],{"type":27,"value":67},{"type":27,"value":134}," in production.",{"type":21,"tag":29,"props":136,"children":137},{},[138,140,146],{"type":27,"value":139},"To setup proxies in Nuxt you need to edit ",{"type":21,"tag":54,"props":141,"children":143},{"className":142},[],[144],{"type":27,"value":145},"nuxt.config.ts",{"type":27,"value":147}," file in the root of your project. This file is used to configure your Nuxt application.",{"type":21,"tag":29,"props":149,"children":150},{},[151,153,159],{"type":27,"value":152},"In this file you need to add a ",{"type":21,"tag":54,"props":154,"children":156},{"className":155},[],[157],{"type":27,"value":158},"nitro.devProxy",{"type":27,"value":160}," property.",{"type":21,"tag":162,"props":163,"children":167},"pre",{"className":164,"code":165,"language":166,"meta":8,"style":8},"language-ts shiki shiki-themes github-light github-dark","export default defineNuxtConfig({\n    nitro: {\n        devProxy: {\n            \"/proxy\": process.env.NUXT_PUBLIC_API_BASE,\n        },\n    },\n})\n","ts",[168],{"type":21,"tag":54,"props":169,"children":170},{"__ignoreMap":8},[171,200,209,218,244,253,262],{"type":21,"tag":172,"props":173,"children":176},"span",{"class":174,"line":175},"line",1,[177,183,188,194],{"type":21,"tag":172,"props":178,"children":180},{"style":179},"--shiki-default:#D73A49;--shiki-dark:#F97583",[181],{"type":27,"value":182},"export",{"type":21,"tag":172,"props":184,"children":185},{"style":179},[186],{"type":27,"value":187}," default",{"type":21,"tag":172,"props":189,"children":191},{"style":190},"--shiki-default:#6F42C1;--shiki-dark:#B392F0",[192],{"type":27,"value":193}," defineNuxtConfig",{"type":21,"tag":172,"props":195,"children":197},{"style":196},"--shiki-default:#24292E;--shiki-dark:#E1E4E8",[198],{"type":27,"value":199},"({\n",{"type":21,"tag":172,"props":201,"children":203},{"class":174,"line":202},2,[204],{"type":21,"tag":172,"props":205,"children":206},{"style":196},[207],{"type":27,"value":208},"    nitro: {\n",{"type":21,"tag":172,"props":210,"children":212},{"class":174,"line":211},3,[213],{"type":21,"tag":172,"props":214,"children":215},{"style":196},[216],{"type":27,"value":217},"        devProxy: {\n",{"type":21,"tag":172,"props":219,"children":221},{"class":174,"line":220},4,[222,228,233,239],{"type":21,"tag":172,"props":223,"children":225},{"style":224},"--shiki-default:#032F62;--shiki-dark:#9ECBFF",[226],{"type":27,"value":227},"            \"/proxy\"",{"type":21,"tag":172,"props":229,"children":230},{"style":196},[231],{"type":27,"value":232},": process.env.",{"type":21,"tag":172,"props":234,"children":236},{"style":235},"--shiki-default:#005CC5;--shiki-dark:#79B8FF",[237],{"type":27,"value":238},"NUXT_PUBLIC_API_BASE",{"type":21,"tag":172,"props":240,"children":241},{"style":196},[242],{"type":27,"value":243},",\n",{"type":21,"tag":172,"props":245,"children":247},{"class":174,"line":246},5,[248],{"type":21,"tag":172,"props":249,"children":250},{"style":196},[251],{"type":27,"value":252},"        },\n",{"type":21,"tag":172,"props":254,"children":256},{"class":174,"line":255},6,[257],{"type":21,"tag":172,"props":258,"children":259},{"style":196},[260],{"type":27,"value":261},"    },\n",{"type":21,"tag":172,"props":263,"children":265},{"class":174,"line":264},7,[266],{"type":21,"tag":172,"props":267,"children":268},{"style":196},[269],{"type":27,"value":270},"})\n",{"type":21,"tag":29,"props":272,"children":273},{},[274,276,281,283,289,291,297,299,305],{"type":27,"value":275},"This will proxy all requests to ",{"type":21,"tag":54,"props":277,"children":279},{"className":278},[],[280],{"type":27,"value":80},{"type":27,"value":282}," that start with ",{"type":21,"tag":54,"props":284,"children":286},{"className":285},[],[287],{"type":27,"value":288},"/proxy",{"type":27,"value":290},". So if you make a request to ",{"type":21,"tag":54,"props":292,"children":294},{"className":293},[],[295],{"type":27,"value":296},"/proxy/users",{"type":27,"value":298}," it will be proxied to ",{"type":21,"tag":54,"props":300,"children":302},{"className":301},[],[303],{"type":27,"value":304},"http://example.com/users",{"type":27,"value":306},".",{"type":21,"tag":91,"props":308,"children":310},{"id":309},"setup-laravel-sanctum",[311],{"type":27,"value":312},"Setup Laravel Sanctum",{"type":21,"tag":29,"props":314,"children":315},{},[316],{"type":27,"value":317},"Now that you have setup proxies in Nuxt you need to setup Laravel Sanctum to work with proxies.",{"type":21,"tag":29,"props":319,"children":320},{},[321,323,329],{"type":27,"value":322},"Sanctum already accepts requests for localhost:3000 so there is no need to change anything. But if you are using a different port in your Nuxt application you need to add it to the ",{"type":21,"tag":54,"props":324,"children":326},{"className":325},[],[327],{"type":27,"value":328},"SANCTUM_STATEFUL_DOMAINS",{"type":27,"value":330}," environment variable in your Laravel application.",{"type":21,"tag":29,"props":332,"children":333},{},[334,336,341],{"type":27,"value":335},"To do this you need to add the URL of your Nuxt application to the ",{"type":21,"tag":54,"props":337,"children":339},{"className":338},[],[340],{"type":27,"value":328},{"type":27,"value":330},{"type":21,"tag":162,"props":343,"children":347},{"className":344,"code":345,"language":346,"meta":8,"style":8},"language-env","SANCTUM_STATEFUL_DOMAINS=localhost:5000\n","env",[348],{"type":21,"tag":54,"props":349,"children":350},{"__ignoreMap":8},[351],{"type":27,"value":345},{"type":21,"tag":29,"props":353,"children":354},{},[355,357,363],{"type":27,"value":356},"This will allow Laravel Sanctum to authenticate users from ",{"type":21,"tag":54,"props":358,"children":360},{"className":359},[],[361],{"type":27,"value":362},"http://localhost:5000",{"type":27,"value":306},{"type":21,"tag":91,"props":365,"children":367},{"id":366},"setup-nuxt-auth-sanctum-module",[368],{"type":27,"value":369},"Setup Nuxt Auth Sanctum Module",{"type":21,"tag":29,"props":371,"children":372},{},[373,375,382,384,390,392,398,400,406,408,413],{"type":27,"value":374},"If you are using the ",{"type":21,"tag":33,"props":376,"children":379},{"href":377,"rel":378},"https://nuxt.com/modules/nuxt-auth-sanctum",[37],[380],{"type":27,"value":381},"Nuxt Auth Sanctum Module",{"type":27,"value":383}," you need to add the ",{"type":21,"tag":54,"props":385,"children":387},{"className":386},[],[388],{"type":27,"value":389},"proxy",{"type":27,"value":391}," property to the ",{"type":21,"tag":54,"props":393,"children":395},{"className":394},[],[396],{"type":27,"value":397},"sanctum",{"type":27,"value":399}," property in the ",{"type":21,"tag":54,"props":401,"children":403},{"className":402},[],[404],{"type":27,"value":405},"auth",{"type":27,"value":407}," property in your ",{"type":21,"tag":54,"props":409,"children":411},{"className":410},[],[412],{"type":27,"value":145},{"type":27,"value":414}," file.",{"type":21,"tag":162,"props":416,"children":418},{"className":164,"code":417,"language":166,"meta":8,"style":8},"export default defineNuxtConfig({\n    sanctum: {\n        baseUrl: \"http://localhost:3000\", // the URL of your Nuxt application\n        endpoints: {\n            csrf: \"/proxy/sanctum/csrf-cookie\", // prefix with your proxy prefix\n            login: \"/proxy/login\",\n            logout: \"/proxy/logout\",\n            user: \"/proxy/api/user\",\n        },\n    },\n})\n",[419],{"type":21,"tag":54,"props":420,"children":421},{"__ignoreMap":8},[422,441,449,473,481,503,520,537,555,563,571],{"type":21,"tag":172,"props":423,"children":424},{"class":174,"line":175},[425,429,433,437],{"type":21,"tag":172,"props":426,"children":427},{"style":179},[428],{"type":27,"value":182},{"type":21,"tag":172,"props":430,"children":431},{"style":179},[432],{"type":27,"value":187},{"type":21,"tag":172,"props":434,"children":435},{"style":190},[436],{"type":27,"value":193},{"type":21,"tag":172,"props":438,"children":439},{"style":196},[440],{"type":27,"value":199},{"type":21,"tag":172,"props":442,"children":443},{"class":174,"line":202},[444],{"type":21,"tag":172,"props":445,"children":446},{"style":196},[447],{"type":27,"value":448},"    sanctum: {\n",{"type":21,"tag":172,"props":450,"children":451},{"class":174,"line":211},[452,457,462,467],{"type":21,"tag":172,"props":453,"children":454},{"style":196},[455],{"type":27,"value":456},"        baseUrl: ",{"type":21,"tag":172,"props":458,"children":459},{"style":224},[460],{"type":27,"value":461},"\"http://localhost:3000\"",{"type":21,"tag":172,"props":463,"children":464},{"style":196},[465],{"type":27,"value":466},", ",{"type":21,"tag":172,"props":468,"children":470},{"style":469},"--shiki-default:#6A737D;--shiki-dark:#6A737D",[471],{"type":27,"value":472},"// the URL of your Nuxt application\n",{"type":21,"tag":172,"props":474,"children":475},{"class":174,"line":220},[476],{"type":21,"tag":172,"props":477,"children":478},{"style":196},[479],{"type":27,"value":480},"        endpoints: {\n",{"type":21,"tag":172,"props":482,"children":483},{"class":174,"line":246},[484,489,494,498],{"type":21,"tag":172,"props":485,"children":486},{"style":196},[487],{"type":27,"value":488},"            csrf: ",{"type":21,"tag":172,"props":490,"children":491},{"style":224},[492],{"type":27,"value":493},"\"/proxy/sanctum/csrf-cookie\"",{"type":21,"tag":172,"props":495,"children":496},{"style":196},[497],{"type":27,"value":466},{"type":21,"tag":172,"props":499,"children":500},{"style":469},[501],{"type":27,"value":502},"// prefix with your proxy prefix\n",{"type":21,"tag":172,"props":504,"children":505},{"class":174,"line":255},[506,511,516],{"type":21,"tag":172,"props":507,"children":508},{"style":196},[509],{"type":27,"value":510},"            login: ",{"type":21,"tag":172,"props":512,"children":513},{"style":224},[514],{"type":27,"value":515},"\"/proxy/login\"",{"type":21,"tag":172,"props":517,"children":518},{"style":196},[519],{"type":27,"value":243},{"type":21,"tag":172,"props":521,"children":522},{"class":174,"line":264},[523,528,533],{"type":21,"tag":172,"props":524,"children":525},{"style":196},[526],{"type":27,"value":527},"            logout: ",{"type":21,"tag":172,"props":529,"children":530},{"style":224},[531],{"type":27,"value":532},"\"/proxy/logout\"",{"type":21,"tag":172,"props":534,"children":535},{"style":196},[536],{"type":27,"value":243},{"type":21,"tag":172,"props":538,"children":540},{"class":174,"line":539},8,[541,546,551],{"type":21,"tag":172,"props":542,"children":543},{"style":196},[544],{"type":27,"value":545},"            user: ",{"type":21,"tag":172,"props":547,"children":548},{"style":224},[549],{"type":27,"value":550},"\"/proxy/api/user\"",{"type":21,"tag":172,"props":552,"children":553},{"style":196},[554],{"type":27,"value":243},{"type":21,"tag":172,"props":556,"children":558},{"class":174,"line":557},9,[559],{"type":21,"tag":172,"props":560,"children":561},{"style":196},[562],{"type":27,"value":252},{"type":21,"tag":172,"props":564,"children":566},{"class":174,"line":565},10,[567],{"type":21,"tag":172,"props":568,"children":569},{"style":196},[570],{"type":27,"value":261},{"type":21,"tag":172,"props":572,"children":574},{"class":174,"line":573},11,[575],{"type":21,"tag":172,"props":576,"children":577},{"style":196},[578],{"type":27,"value":270},{"type":21,"tag":29,"props":580,"children":581},{},[582],{"type":27,"value":583},"This will make sure that the Nuxt Auth Sanctum Module makes requests to the correct URL.",{"type":21,"tag":91,"props":585,"children":587},{"id":586},"error-h3-unhandled-unable-to-verify-the-first-certificate",[588,590,595,597,602],{"type":27,"value":589},"ERROR  ",{"type":21,"tag":172,"props":591,"children":592},{},[593],{"type":27,"value":594},"h3",{"type":27,"value":596}," ",{"type":21,"tag":172,"props":598,"children":599},{},[600],{"type":27,"value":601},"unhandled",{"type":27,"value":603}," unable to verify the first certificate",{"type":21,"tag":29,"props":605,"children":606},{},[607,609,615,617,623,625,631,632,637],{"type":27,"value":608},"If you are getting the ",{"type":21,"tag":54,"props":610,"children":612},{"className":611},[],[613],{"type":27,"value":614},"ERROR  [h3] [unhandled] unable to verify the first certificate",{"type":27,"value":616}," error when you request a proxied URL you will need to add ",{"type":21,"tag":54,"props":618,"children":620},{"className":619},[],[621],{"type":27,"value":622},"changeOrigin: true",{"type":27,"value":624}," to the ",{"type":21,"tag":54,"props":626,"children":628},{"className":627},[],[629],{"type":27,"value":630},"devProxy",{"type":27,"value":407},{"type":21,"tag":54,"props":633,"children":635},{"className":634},[],[636],{"type":27,"value":145},{"type":27,"value":414},{"type":21,"tag":162,"props":639,"children":641},{"className":164,"code":640,"language":166,"meta":8,"style":8},"export default defineNuxtConfig({\n    nitro: {\n        devProxy: {\n            \"/proxy\": {\n                target: process.env.NUXT_PUBLIC_API_BASE,\n                changeOrigin: true,\n            },\n        },\n    },\n})\n",[642],{"type":21,"tag":54,"props":643,"children":644},{"__ignoreMap":8},[645,664,671,678,690,706,723,731,738,745],{"type":21,"tag":172,"props":646,"children":647},{"class":174,"line":175},[648,652,656,660],{"type":21,"tag":172,"props":649,"children":650},{"style":179},[651],{"type":27,"value":182},{"type":21,"tag":172,"props":653,"children":654},{"style":179},[655],{"type":27,"value":187},{"type":21,"tag":172,"props":657,"children":658},{"style":190},[659],{"type":27,"value":193},{"type":21,"tag":172,"props":661,"children":662},{"style":196},[663],{"type":27,"value":199},{"type":21,"tag":172,"props":665,"children":666},{"class":174,"line":202},[667],{"type":21,"tag":172,"props":668,"children":669},{"style":196},[670],{"type":27,"value":208},{"type":21,"tag":172,"props":672,"children":673},{"class":174,"line":211},[674],{"type":21,"tag":172,"props":675,"children":676},{"style":196},[677],{"type":27,"value":217},{"type":21,"tag":172,"props":679,"children":680},{"class":174,"line":220},[681,685],{"type":21,"tag":172,"props":682,"children":683},{"style":224},[684],{"type":27,"value":227},{"type":21,"tag":172,"props":686,"children":687},{"style":196},[688],{"type":27,"value":689},": {\n",{"type":21,"tag":172,"props":691,"children":692},{"class":174,"line":246},[693,698,702],{"type":21,"tag":172,"props":694,"children":695},{"style":196},[696],{"type":27,"value":697},"                target: process.env.",{"type":21,"tag":172,"props":699,"children":700},{"style":235},[701],{"type":27,"value":238},{"type":21,"tag":172,"props":703,"children":704},{"style":196},[705],{"type":27,"value":243},{"type":21,"tag":172,"props":707,"children":708},{"class":174,"line":255},[709,714,719],{"type":21,"tag":172,"props":710,"children":711},{"style":196},[712],{"type":27,"value":713},"                changeOrigin: ",{"type":21,"tag":172,"props":715,"children":716},{"style":235},[717],{"type":27,"value":718},"true",{"type":21,"tag":172,"props":720,"children":721},{"style":196},[722],{"type":27,"value":243},{"type":21,"tag":172,"props":724,"children":725},{"class":174,"line":264},[726],{"type":21,"tag":172,"props":727,"children":728},{"style":196},[729],{"type":27,"value":730},"            },\n",{"type":21,"tag":172,"props":732,"children":733},{"class":174,"line":539},[734],{"type":21,"tag":172,"props":735,"children":736},{"style":196},[737],{"type":27,"value":252},{"type":21,"tag":172,"props":739,"children":740},{"class":174,"line":557},[741],{"type":21,"tag":172,"props":742,"children":743},{"style":196},[744],{"type":27,"value":261},{"type":21,"tag":172,"props":746,"children":747},{"class":174,"line":565},[748],{"type":21,"tag":172,"props":749,"children":750},{"style":196},[751],{"type":27,"value":270},{"type":21,"tag":91,"props":753,"children":755},{"id":754},"conclusion",[756],{"type":27,"value":757},"Conclusion",{"type":21,"tag":29,"props":759,"children":760},{},[761,763,768,769,774],{"type":27,"value":762},"That's it. You have now setup proxies in Nuxt for Laravel Sanctum. You can now make requests to ",{"type":21,"tag":54,"props":764,"children":766},{"className":765},[],[767],{"type":27,"value":80},{"type":27,"value":127},{"type":21,"tag":54,"props":770,"children":772},{"className":771},[],[773],{"type":27,"value":67},{"type":27,"value":134},{"type":21,"tag":776,"props":777,"children":778},"style",{},[779],{"type":27,"value":780},"html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}",{"title":8,"searchDepth":202,"depth":202,"links":782},[783,784,785,786,788],{"id":93,"depth":202,"text":96},{"id":309,"depth":202,"text":312},{"id":366,"depth":202,"text":369},{"id":586,"depth":202,"text":787},"ERROR  h3 unhandled unable to verify the first certificate",{"id":754,"depth":202,"text":757},"markdown","content:articles:1.setup-proxies-in-nuxt-for-laravel-sanctum.md","content","articles/1.setup-proxies-in-nuxt-for-laravel-sanctum.md","md",{"loc":5},1706019286566]